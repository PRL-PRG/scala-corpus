syntax = "proto2";

package cz.cvut.fit.prl.scala.implicits.model;

enum Language {
    UNKNOWN_LANGUAGE = 0;
    SCALA = 1;
    JAVA = 2;
}

message Position {
    required int32 startLine = 1;
    required int32 startCol = 2;
    required int32 endLine = 3;
    required int32 endCol = 4;
}

message Location {
    oneof sealed_value {
        Local local = 1;
        External external = 2;
        SyntheticLocation synthetic = 3;
    }
}

message Local {
    required string path = 1;
    required Position position = 2;
}

message External {
    required bool compressed = 1;
    required string path = 2;
    required string entry = 3;
}

message SyntheticLocation {

}

message Project {
    required string projectId = 1;
    repeated Declaration declarations = 2;
    repeated CallSite callSites = 5;
}

message DeclarationRef {
    required Location location = 1;
    required string fqn = 2;
}

message Declaration {
    enum Kind {
        DEF = 0;
        VAL = 1;
        VAR = 2;
        TYPE = 3;
        CLASS = 4;
        TRAIT = 5;
        OBJECT = 6;
        INTERFACE = 7;
        ENUM = 8;
        MACRO = 9;
        TYPE_PARAMETER = 10;
    };

    required Kind kind = 1;
    required string fqn = 2;
    required string name = 3;
    required Location location = 4;
    required Language language = 5;
    required bool isImplicit = 6;

    oneof signature {
        TypeSignature type = 8;
        MethodSignature method = 9;
    }
}

message MethodSignature {
    repeated TypeParameter type_parameters = 3;
    repeated ParameterList parameter_lists = 4;
    required Type return_type = 5;
}

message TypeSignature {
    repeated TypeParameter type_parameters = 3;
    repeated Type parents = 4;
}

message TypeParameter {
    required string name = 1;
    repeated TypeParameter type_parameters = 2;
    optional Type upper_bound = 3;
    optional Type lower_bound = 4;
}

message ParameterList {
    repeated Parameter parameters = 1;
}

message Parameter {
    required string name = 1;
    required Type tpe = 2;
    required bool isImplicit = 3;
}

message Type {
    oneof sealed_value {
        TypeRef type_ref = 1;
        TypeParameterRef type_parameter_ref = 2;
    }
}

message TypeRef {
    required DeclarationRef ref = 1;
    repeated Type type_arguments = 2;
}

message TypeParameterRef {
    required DeclarationRef ref = 1;
    required string name = 2;
    repeated Type type_arguments = 3;
}

message CallSite {
    required DeclarationRef ref = 1;
    required string code = 3;
    required Location location = 4;
    repeated Type type_arguments = 5;
    repeated TypeRef implicit_argument_types = 6;
}

//message ArgumentLists {
//    repeated Argument arguments = 1;
//}

